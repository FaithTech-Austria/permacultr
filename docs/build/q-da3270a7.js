var ye,Ie,Se;function Ve(f,S){if(!ye)ye=S;else if(!Ie)Ie=S;else{var W="var sharedChunk = {}; ("+ye+")(sharedChunk); ("+Ie+")(sharedChunk);",A={};ye(A),Se=S(A),typeof window<"u"&&(Se.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}Ve(["exports"],function(f){class S{constructor(t,i){this.start=t,this.end=i,this.points=[],this.append=this.append.bind(this),this.prepend=this.prepend.bind(this)}append(t,i){this.points.push(Math.round(t),Math.round(i))}prepend(t,i){this.points.splice(0,0,Math.round(t),Math.round(i))}lineString(){return this.toArray()}isEmpty(){return this.points.length<2}appendFragment(t){this.points.push(...t.points),this.end=t.end}toArray(){return this.points}}const W=[[],[[[1,2],[0,1]]],[[[2,1],[1,2]]],[[[2,1],[0,1]]],[[[1,0],[2,1]]],[[[1,2],[0,1]],[[1,0],[2,1]]],[[[1,0],[1,2]]],[[[1,0],[0,1]]],[[[0,1],[1,0]]],[[[1,2],[1,0]]],[[[0,1],[1,0]],[[2,1],[1,2]]],[[[2,1],[1,0]]],[[[0,1],[2,1]]],[[[1,2],[2,1]]],[[[0,1],[1,2]]],[]];function A(e,t,i,r){return t=t*2+r[0],i=i*2+r[1],t+i*(e+1)*2}function Y(e,t,i){return(t-e)/(i-e)}function m(e,t,i=4096,r=1){if(!e)return{};const n=i/(t.width-1);let s,o,l,a,h,c;const d={},u=new Map,p=new Map;function k(g,P,F){g[0]===0?F(n*(c-1),n*(h-Y(l,P,s))):g[0]===2?F(n*c,n*(h-Y(a,P,o))):g[1]===0?F(n*(c-Y(o,P,s)),n*(h-1)):F(n*(c-Y(a,P,l)),n*h)}for(h=1-r;h<t.height+r;h++){o=t.get(0,h-1),a=t.get(0,h);let g=Math.min(o,a),P=Math.max(o,a);for(c=1-r;c<t.width+r;c++){s=o,l=a,o=t.get(c,h-1),a=t.get(c,h);const F=g,j=P;if(g=Math.min(o,a),P=Math.max(o,a),isNaN(s)||isNaN(o)||isNaN(a)||isNaN(l))continue;const B=Math.min(F,g),C=Math.max(j,P),G=Math.ceil(B/e)*e,Be=Math.floor(C/e)*e;for(let M=G;M<=Be;M+=e){const Ce=s>M,Te=o>M,ge=l>M,Ne=a>M;for(const me of W[(Ce?8:0)|(Te?4:0)|(Ne?2:0)|(ge?1:0)]){let te=u.get(M);te||u.set(M,te=new Map);let se=p.get(M);se||p.set(M,se=new Map);const De=me[0],Fe=me[1],we=A(t.width,c,h,De),oe=A(t.width,c,h,Fe);let N,ve;if(N=se.get(we))if(se.delete(we),ve=te.get(oe))if(te.delete(oe),N===ve){if(k(Fe,M,N.append),!N.isEmpty()){let ie=d[M];ie||(d[M]=ie=[]),ie.push(N.lineString())}}else N.appendFragment(ve),se.set(N.end=ve.end,N);else k(Fe,M,N.append),se.set(N.end=oe,N);else if(N=te.get(oe))te.delete(oe),k(De,M,N.prepend),te.set(N.start=we,N);else{const ie=new S(we,oe);k(De,M,ie.append),k(Fe,M,ie.append),te.set(we,ie),se.set(oe,ie)}}}}}for(const[g,P]of u.entries()){let F=null;for(const j of P.values())j.isEmpty()||(F==null&&(F=d[g]||(d[g]=[])),F.push(j.lineString()))}return d}let R=0;class E{constructor(t=100){this.size=()=>this.items.size,this.get=(i,r)=>this.getCancelable(i,n=>({value:r(n),cancel:()=>{}})).value,this.getCancelable=(i,r)=>{let n=this.items.get(i);if(n)n.lastUsed=++R,n.waiting++;else{const a=r(i);n={cancel:a.cancel,item:a.value,lastUsed:++R,waiting:1},this.items.set(i,n),this.prune()}const s=this.items,o=n.item.then(a=>a,a=>(s.delete(i),Promise.reject(a)));let l=!1;return{value:o,cancel:()=>{n&&n.cancel&&!l&&(l=!0,--n.waiting<=0&&(n.cancel(),s.delete(i)))}}},this.clear=()=>this.items.clear(),this.maxSize=t,this.items=new Map}prune(){if(this.items.size>this.maxSize){let t,i=1/0;this.items.forEach((r,n)=>{r.lastUsed<i&&(i=r.lastUsed,t=n)}),typeof t<"u"&&this.items.delete(t)}}}function O(e){const t=Object.entries(e);return t.sort(([i],[r])=>i<r?-1:i>r?1:0),t}function q(e){return O(e).map(([t,i])=>[t,...typeof i=="number"?[i]:i].join("*")).join("~")}function v(e){return Object.fromEntries(e.split("~").map(t=>t.split("*").map(Number)).map(([t,...i])=>[t,i]))}function y({thresholds:e,...t}){return O({thresholds:q(e),...t}).map(([i,r])=>`${encodeURIComponent(i)}=${encodeURIComponent(r)}`).join("&")}function V(e){return Object.fromEntries(e.replace(/^.*\?/,"").split("&").map(t=>{const i=t.split("=").map(decodeURIComponent),r=i[0];let n=i[1];switch(r){case"thresholds":n=v(n);break;case"extent":case"multiplier":case"overzoom":case"buffer":n=Number(n)}return[r,n]}))}function D(e){return O(e).map(([t,i])=>`${encodeURIComponent(t)}=${encodeURIComponent(i)}`).join(",")}function K(e,t){const{thresholds:i,...r}=e;let n=[],s=-1/0;return Object.entries(i).forEach(([o,l])=>{const a=Number(o);a<=t&&a>s&&(s=a,n=typeof l=="number"?[l]:l)}),{levels:n,...r}}function L({cancel:e,value:t},i){return{cancel:e,value:t.then(i)}}function de(e){const t=new ArrayBuffer(e.byteLength);return new Uint8Array(t).set(new Uint8Array(e)),t}function ue(e,t){return L(e,({data:i,...r})=>{let n=i;return t&&(n=new Float32Array(i.length),n.set(i)),{...r,data:n,transferrables:[n.buffer]}})}function X(e){return L(e,({arrayBuffer:t})=>{const i=de(t);return{arrayBuffer:i,transferrables:[i]}})}let T=null;function Z(){return T==null&&(T=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),T||!1}function b(e,{value:t,cancel:i}){let r=()=>{};const n=setTimeout(()=>{i(),r(new Error("timed out"))},e),s=new Promise((o,l)=>{r=l});return{value:Promise.race([s,(async()=>{try{return await t}finally{clearTimeout(n)}})()]),cancel:()=>{clearTimeout(n),i()}}}let x,ee,$,ne;function fe(e,t){let i=!1;return{value:createImageBitmap(e).then(n=>i?null:(x||(x=new OffscreenCanvas(n.width,n.height),ee=x.getContext("2d",{willReadFrequently:!0})),I(n,t,x,ee))),cancel:()=>{i=!0}}}function re(e,t){$||($=document.createElement("canvas"),ne=$.getContext("2d",{willReadFrequently:!0}));let i=!1;const r=new Image;return{value:new Promise((s,o)=>{r.onload=()=>{i||s(r),URL.revokeObjectURL(r.src),r.onload=null},r.onerror=()=>o(new Error("Could not load image.")),r.src=e.size?URL.createObjectURL(e):""}).then(s=>I(s,t,$,ne)),cancel:()=>{i=!0,r.src=""}}}function ae(e,t){return self.actor.send("decodeImage",[],void 0,e,t)}function J(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}const z=Z()?fe:J()?ae:re;function I(e,t,i,r){if(i.width=e.width,i.height=e.height,!r)throw new Error("failed to get context");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height).data;return _(e.width,e.height,t,n)}function _(e,t,i,r){const n=i==="mapbox"?(o,l,a)=>-1e4+(o*256*256+l*256+a)*.1:(o,l,a)=>o*256+l+a/256-32768,s=new Float32Array(e*t);for(let o=0;o<r.length;o+=4)s[o/4]=n(r[o],r[o+1],r[o+2]);return{width:e,height:t,data:s}}const $e=-12e3,ze=9e3;function _e(e){return!isNaN(e)&&e>=$e&&e<=ze}class U{constructor(t,i,r){this.split=(n,s,o)=>{if(n===0)return this;const l=1<<n,a=s*this.width/l,h=o*this.height/l;return new U(this.width/l,this.height/l,(c,d)=>this.get(c+a,d+h))},this.subsamplePixelCenters=n=>{const s=(a,h,c)=>isNaN(a)?h:isNaN(h)?a:a+(h-a)*c;if(n<=1)return this;const o=.5-1/(2*n),l=(a,h)=>{const c=a/n-o,d=h/n-o,u=Math.floor(c),p=Math.floor(d),k=this.get(u,p),g=this.get(u+1,p),P=this.get(u,p+1),F=this.get(u+1,p+1),j=c-u,B=d-p,C=s(k,g,j),G=s(P,F,j);return s(C,G,B)};return new U(this.width*n,this.height*n,l)},this.averagePixelCentersToGrid=(n=1)=>new U(this.width+1,this.height+1,(s,o)=>{let l=0,a=0,h=0;for(let c=s-n;c<s+n;c++)for(let d=o-n;d<o+n;d++)isNaN(h=this.get(c,d))||(a++,l+=h);return a===0?NaN:l/a}),this.scaleElevation=n=>n===1?this:new U(this.width,this.height,(s,o)=>this.get(s,o)*n),this.materialize=(n=2)=>{const s=this.width+2*n,o=new Float32Array(s*(this.height+2*n));let l=0;for(let a=-n;a<this.height+n;a++)for(let h=-n;h<this.width+n;h++)o[l++]=this.get(h,a);return new U(this.width,this.height,(a,h)=>o[(h+n)*s+a+n])},this.get=r,this.width=t,this.height=i}static fromRawDem(t){return new U(t.width,t.height,(i,r)=>{const n=t.data[r*t.width+i];return _e(n)?n:NaN})}static combineNeighbors(t){if(t.length!==9)throw new Error("Must include a tile plus 8 neighbors");const i=t[4];if(!i)return;const r=i.width,n=i.height;return new U(r,n,(s,o)=>{let l=0;o<0?o+=n:o<n?l+=3:(o-=n,l+=6),s<0?s+=r:s<r?l+=1:(s-=r,l+=2);const a=t[l];return a?a.get(s,o):NaN})}}function je(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Me={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Me.read=function(e,t,i,r,n){var s,o,l=n*8-r-1,a=(1<<l)-1,h=a>>1,c=-7,d=i?n-1:0,u=i?-1:1,p=e[t+d];for(d+=u,s=p&(1<<-c)-1,p>>=-c,c+=l;c>0;s=s*256+e[t+d],d+=u,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=r;c>0;o=o*256+e[t+d],d+=u,c-=8);if(s===0)s=1-h;else{if(s===a)return o?NaN:(p?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-h}return(p?-1:1)*o*Math.pow(2,s-r)},Me.write=function(e,t,i,r,n,s){var o,l,a,h=s*8-n-1,c=(1<<h)-1,d=c>>1,u=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:s-1,k=r?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(l=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(a=Math.pow(2,-o))<1&&(o--,a*=2),o+d>=1?t+=u/a:t+=u*Math.pow(2,1-d),t*a>=2&&(o++,a/=2),o+d>=c?(l=0,o=c):o+d>=1?(l=(t*a-1)*Math.pow(2,n),o=o+d):(l=t*Math.pow(2,d-1)*Math.pow(2,n),o=0));n>=8;e[i+p]=l&255,p+=k,l/=256,n-=8);for(o=o<<n|l,h+=n;h>0;e[i+p]=o&255,p+=k,o/=256,h-=8);e[i+p-k]|=g*128};var Ge=w,pe=Me;function w(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}w.Varint=0,w.Fixed64=1,w.Bytes=2,w.Fixed32=5;var ke=65536*65536,Ee=1/ke,We=12,Oe=typeof TextDecoder>"u"?null:new TextDecoder("utf8");w.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,s=this.pos;this.type=r&7,e(n,t,this),this.pos===s&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=xe(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Ae(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=xe(this.buf,this.pos)+xe(this.buf,this.pos+4)*ke;return this.pos+=8,e},readSFixed64:function(){var e=xe(this.buf,this.pos)+Ae(this.buf,this.pos+4)*ke;return this.pos+=8,e},readFloat:function(){var e=pe.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=pe.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,i,r;return r=t[this.pos++],i=r&127,r<128||(r=t[this.pos++],i|=(r&127)<<7,r<128)||(r=t[this.pos++],i|=(r&127)<<14,r<128)||(r=t[this.pos++],i|=(r&127)<<21,r<128)?i:(r=t[this.pos],i|=(r&15)<<28,Ye(i,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=We&&Oe?ot(this.buf,t,e):st(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==w.Bytes)return e.push(this.readVarint(t));var i=H(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==w.Bytes)return e.push(this.readSVarint());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==w.Bytes)return e.push(this.readBoolean());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==w.Bytes)return e.push(this.readFloat());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==w.Bytes)return e.push(this.readDouble());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==w.Bytes)return e.push(this.readFixed32());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==w.Bytes)return e.push(this.readSFixed32());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==w.Bytes)return e.push(this.readFixed64());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==w.Bytes)return e.push(this.readSFixed64());var t=H(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===w.Varint)for(;this.buf[this.pos++]>127;);else if(t===w.Bytes)this.pos=this.readVarint()+this.pos;else if(t===w.Fixed32)this.pos+=4;else if(t===w.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),le(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),le(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),le(this.buf,e&-1,this.pos),le(this.buf,Math.floor(e*Ee),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),le(this.buf,e&-1,this.pos),le(this.buf,Math.floor(e*Ee),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){Ke(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=at(this.buf,e,this.pos);var i=this.pos-t;i>=128&&Ue(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),pe.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),pe.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&Ue(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,w.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Je,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,He,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,et,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Qe,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,qe,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,tt,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,it,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,nt,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,rt,t)},writeBytesField:function(e,t){this.writeTag(e,w.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,w.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,w.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,w.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,w.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,w.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,w.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,w.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,w.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,w.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function Ye(e,t,i){var r=i.buf,n,s;if(s=r[i.pos++],n=(s&112)>>4,s<128||(s=r[i.pos++],n|=(s&127)<<3,s<128)||(s=r[i.pos++],n|=(s&127)<<10,s<128)||(s=r[i.pos++],n|=(s&127)<<17,s<128)||(s=r[i.pos++],n|=(s&127)<<24,s<128)||(s=r[i.pos++],n|=(s&1)<<31,s<128))return he(e,n,t);throw new Error("Expected varint not more than 10 bytes")}function H(e){return e.type===w.Bytes?e.readVarint()+e.pos:e.pos+1}function he(e,t,i){return i?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function Ke(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(i=~(-e%4294967296),r=~(-e/4294967296),i^4294967295?i=i+1|0:(i=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),Xe(i,r,t),Ze(r,t)}function Xe(e,t,i){i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos++]=e&127|128,e>>>=7,i.buf[i.pos]=e&127}function Ze(e,t){var i=(e&7)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function Ue(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function Je(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function He(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Qe(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function qe(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function et(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function tt(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function it(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function nt(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function rt(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function xe(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function le(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function Ae(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function st(e,t,i){for(var r="",n=t;n<i;){var s=e[n],o=null,l=s>239?4:s>223?3:s>191?2:1;if(n+l>i)break;var a,h,c;l===1?s<128&&(o=s):l===2?(a=e[n+1],(a&192)===128&&(o=(s&31)<<6|a&63,o<=127&&(o=null))):l===3?(a=e[n+1],h=e[n+2],(a&192)===128&&(h&192)===128&&(o=(s&15)<<12|(a&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):l===4&&(a=e[n+1],h=e[n+2],c=e[n+3],(a&192)===128&&(h&192)===128&&(c&192)===128&&(o=(s&15)<<18|(a&63)<<12|(h&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,l=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),n+=l}return r}function ot(e,t,i){return Oe.decode(e.subarray(t,i))}function at(e,t,i){for(var r=0,n,s;r<t.length;r++){if(n=t.charCodeAt(r),n>55295&&n<57344)if(s)if(n<56320){e[i++]=239,e[i++]=191,e[i++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||r+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):s=n;continue}else s&&(e[i++]=239,e[i++]=191,e[i++]=189,s=null);n<128?e[i++]=n:(n<2048?e[i++]=n>>6|192:(n<65536?e[i++]=n>>12|224:(e[i++]=n>>18|240,e[i++]=n>>12&63|128),e[i++]=n>>6&63|128),e[i++]=n&63|128)}return i}var ht=je(Ge),ce;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"})(ce||(ce={}));function lt(e){const t=new ht;for(const i in e.layers){const r=e.layers[i];r.extent||(r.extent=e.extent),t.writeMessage(3,ct,{...r,id:i})}return t.finish()}function ct(e,t){if(!t)throw new Error("pbf undefined");t.writeVarintField(15,2),t.writeStringField(1,e.id||""),t.writeVarintField(5,e.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(const r of e.features)i.feature=r,t.writeMessage(2,dt,i);for(const r of i.keys)t.writeStringField(3,r);for(const r of i.values)t.writeMessage(4,wt,r)}function dt(e,t){const i=e.feature;if(!i||!t)throw new Error;t.writeMessage(2,ut,e),t.writeVarintField(3,i.type),t.writeMessage(4,ft,i)}function ut(e,t){const i=e.feature;if(!i||!t)throw new Error;const r=e.keys,n=e.values,s=e.keycache,o=e.valuecache;for(const l in i.properties){let a=i.properties[l],h=s[l];if(a===null)continue;typeof h>"u"&&(r.push(l),h=r.length-1,s[l]=h),t.writeVarint(h);const c=typeof a;c!=="string"&&c!=="boolean"&&c!=="number"&&(a=JSON.stringify(a));const d=`${c}:${a}`;let u=o[d];typeof u>"u"&&(n.push(a),u=n.length-1,o[d]=u),t.writeVarint(u)}}function Pe(e,t){return(t<<3)+(e&7)}function Re(e){return e<<1^e>>31}function ft(e,t){if(!t)throw new Error;const i=e.geometry,r=e.type;let n=0,s=0;for(const o of i){let l=1;r===ce.POINT&&(l=o.length/2),t.writeVarint(Pe(1,l));const a=o.length/2,h=r===ce.POLYGON?a-1:a;for(let c=0;c<h;c++){c===1&&r!==1&&t.writeVarint(Pe(2,h-1));const d=o[c*2]-n,u=o[c*2+1]-s;t.writeVarint(Re(d)),t.writeVarint(Re(u)),n+=d,s+=u}r===ce.POLYGON&&t.writeVarint(Pe(7,1))}}function wt(e,t){if(!t)throw new Error;typeof e=="string"?t.writeStringField(1,e):typeof e=="boolean"?t.writeBooleanField(7,e):typeof e=="number"&&(e%1!==0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}class pt{constructor(t,i,r,n,s){this.loaded=Promise.resolve(),this.decodeImage=z,this.fetchAndParseTile=(o,l,a,h)=>{const c=this,d=this.demUrlPattern.replace("{z}",o.toString()).replace("{x}",l.toString()).replace("{y}",a.toString());return h==null||h.useTile(d),this.parsedCache.getCancelable(d,()=>{const u=c.fetchTile(o,l,a,h);let p=!1,k=()=>{};return{value:u.value.then(async g=>{if(p)throw new Error("canceled");const P=c.decodeImage(g.data,c.encoding);k=P.cancel;const F=h==null?void 0:h.marker("decode"),j=await P.value;return F==null||F(),j}),cancel:()=>{p=!0,k(),u.cancel()}}})},this.tileCache=new E(i),this.parsedCache=new E(i),this.contourCache=new E(i),this.timeoutMs=s,this.demUrlPattern=t,this.encoding=r,this.maxzoom=n}fetchTile(t,i,r,n){const s=this.demUrlPattern.replace("{z}",t.toString()).replace("{x}",i.toString()).replace("{y}",r.toString());return n==null||n.useTile(s),this.tileCache.getCancelable(s,()=>{let o=()=>{};const l={};try{const h=new AbortController;l.signal=h.signal,o=()=>h.abort()}catch{}n==null||n.fetchTile(s);const a=n==null?void 0:n.marker("fetch");return b(this.timeoutMs,{value:fetch(s,l).then(async h=>{if(a==null||a(),!h.ok)throw new Error(`Bad response: ${h.status} for ${s}`);return{data:await h.blob(),expires:h.headers.get("expires")||void 0,cacheControl:h.headers.get("cache-control")||void 0}}),cancel:o})})}fetchDem(t,i,r,n,s){const o=Math.min(t-(n.overzoom||0),this.maxzoom),l=t-o,a=1<<l,h=Math.floor(i/a),c=Math.floor(r/a),{value:d,cancel:u}=this.fetchAndParseTile(o,h,c,s),p=i%a,k=r%a;return{value:d.then(g=>U.fromRawDem(g).split(l,p,k)),cancel:u}}fetchContourTile(t,i,r,n,s){const{levels:o,multiplier:l=1,buffer:a=1,extent:h=4096,contourLayer:c="contours",elevationKey:d="ele",levelKey:u="level",subsampleBelow:p=100}=n;if(!o||o.length===0)return{cancel(){},value:Promise.resolve({arrayBuffer:new ArrayBuffer(0)})};const k=[t,i,r,D(n)].join("/");return this.contourCache.getCancelable(k,()=>{const g=1<<t;let P=!1;const F=[];for(let B=r-1;B<=r+1;B++)for(let C=i-1;C<=i+1;C++)F.push(B<0||B>=g?null:this.fetchDem(t,(C+g)%g,B,n,s));return{value:Promise.all(F.map(B=>B==null?void 0:B.value)).then(async B=>{let C=U.combineNeighbors(B);if(!C||P)return{arrayBuffer:new Uint8Array().buffer};const G=s==null?void 0:s.marker("isoline");if(C.width>=p)C=C.materialize(2);else for(;C.width<p;)C=C.subsamplePixelCenters(2).materialize(2);C=C.averagePixelCentersToGrid().scaleElevation(l).materialize(1);const Be=m(o[0],C,h,a);G==null||G();const M=lt({extent:h,layers:{[c]:{features:Object.entries(Be).map(([Ce,Te])=>{const ge=Number(Ce);return{type:ce.LINESTRING,geometry:Te,properties:{[d]:ge,[u]:Math.max(...o.map((Ne,me)=>ge%Ne===0?me:0))}}})}}});return G==null||G(),{arrayBuffer:M.buffer}}),cancel(){P=!0,F.forEach(B=>B&&B.cancel())}}})}}const Q=typeof performance<"u"?performance:void 0,xt=Q?Q.timeOrigin||new Date().getTime()-Q.now():new Date().getTime();function gt(e){var t;return JSON.parse(JSON.stringify(((t=Q==null?void 0:Q.getEntriesByName)===null||t===void 0?void 0:t.call(Q,e))||[]))}function Le(){return Q?Q.now():new Date().getTime()}function mt(e){const t=[];for(const i of e)t.push(...i);return t}class be{constructor(t){this.marks={},this.urls=[],this.fetched=[],this.resources=[],this.tilesFetched=0,this.timeOrigin=xt,this.finish=i=>{this.markFinish();const r=a=>{const h=this.marks[a]||[],c=Math.max(...h.map(u=>Math.max(...u))),d=Math.min(...h.map(u=>Math.min(...u)));return Number.isFinite(c)?c-d:void 0},n=r("main")||0,s=r("fetch"),o=r("decode"),l=r("isoline");return{url:i,tilesUsed:this.tilesFetched,origin:this.timeOrigin,marks:this.marks,resources:[...this.resources,...mt(this.fetched.map(gt))],duration:n,fetch:s,decode:o,process:l,wait:n-(s||0)-(o||0)-(l||0)}},this.error=i=>({...this.finish(i),error:!0}),this.marker=i=>{var r;this.marks[i]||(this.marks[i]=[]);const n=[Le()];return(r=this.marks[i])===null||r===void 0||r.push(n),()=>n.push(Le())},this.useTile=i=>{this.urls.indexOf(i)<0&&(this.urls.push(i),this.tilesFetched++)},this.fetchTile=i=>{this.fetched.indexOf(i)<0&&this.fetched.push(i)},this.addAll=i=>{var r;this.tilesFetched+=i.tilesUsed;const n=i.origin-this.timeOrigin;for(const s in i.marks){const o=s;(this.marks[o]||(this.marks[o]=[])).push(...((r=i.marks[o])===null||r===void 0?void 0:r.map(a=>a.map(h=>h+n)))||[])}this.resources.push(...i.resources.map(s=>vt(s,n)))},this.markFinish=this.marker(t)}}const Ft=/(Start$|End$|^start|^end)/;function vt(e,t){const i={};for(const r in e)e[r]!==0&&Ft.test(r)?i[r]=Number(e[r])+t:i[r]=e[r];return i}let yt=0;class Mt{constructor(t,i,r=2e4){this.callbacks={},this.cancels={},this.dest=t,this.timeoutMs=r,this.dest.onmessage=async({data:n})=>{const s=n;if(s.type==="cancel"){const o=this.cancels[s.id];delete this.cancels[s.id],o&&o()}else if(s.type==="response"){const o=this.callbacks[s.id];delete this.callbacks[s.id],o&&o(s.error?new Error(s.error):void 0,s.response,s.timings)}else if(s.type==="request"){const o=new be("worker"),l=i[s.name],a=l.apply(l,[...s.args,o]),h=`${s.name}_${s.id}`;if(s.id&&a){this.cancels[s.id]=a.cancel;try{const c=await a.value,d=c==null?void 0:c.transferrables;this.postMessage({id:s.id,type:"response",response:c,timings:o.finish(h)},d)}catch(c){this.postMessage({id:s.id,type:"response",error:(c==null?void 0:c.toString())||"error",timings:o.finish(h)})}delete this.cancels[s.id]}}}}postMessage(t,i){this.dest.postMessage(t,i||[])}send(t,i,r,...n){const s=++yt,o=new Promise((l,a)=>{this.postMessage({id:s,type:"request",name:t,args:n},i),this.callbacks[s]=(h,c,d)=>{r==null||r.addAll(d),h?a(h):l(c)}});return b(this.timeoutMs,{value:o,cancel:()=>{delete this.callbacks[s],this.postMessage({id:s,type:"cancel"})}})}}f.Actor=Mt,f.HeightTile=U,f.LocalDemManager=pt,f.Timer=be,f.decodeOptions=V,f.decodeParsedImage=_,f.defaultDecoder=z,f.encodeOptions=y,f.generateIsolines=m,f.getOptionsForZoom=K,f.prepareContourTile=X,f.prepareDemTile=ue});Ve(["./shared"],function(f){const S=Y=>({cancel(){},value:Promise.reject(new Error(`No manager registered for ${Y}`))});class W{constructor(){this.managers={},this.init=m=>(this.managers[m.managerId]=new f.LocalDemManager(m.demUrlPattern,m.cacheSize,m.encoding,m.maxzoom,m.timeoutMs),{cancel(){},value:Promise.resolve()}),this.fetchTile=(m,R,E,O,q)=>{var v;return((v=this.managers[m])===null||v===void 0?void 0:v.fetchTile(R,E,O,q))||S(m)},this.fetchAndParseTile=(m,R,E,O,q)=>{var v;return f.prepareDemTile(((v=this.managers[m])===null||v===void 0?void 0:v.fetchAndParseTile(R,E,O,q))||S(m),!0)},this.fetchContourTile=(m,R,E,O,q,v)=>{var y;return f.prepareContourTile(((y=this.managers[m])===null||y===void 0?void 0:y.fetchContourTile(R,E,O,q,v))||S(m))}}}const A=typeof self<"u"?self:typeof window<"u"?window:global;A.actor=new f.Actor(A,new W)});Ve(["./shared"],function(f){const S={workerUrl:""};let W,A=0;class Y{constructor(){this.decodeImage=(y,V)=>f.prepareDemTile(f.defaultDecoder(y,V),!1)}}function m(){if(!W){const v=new Worker(S.workerUrl),y=new Y;W=new f.Actor(v,y)}return W}class R{constructor(y,V,D,K,L,de){this.fetchTile=(X,T,Z,b)=>this.actor.send("fetchTile",[],b,this.managerId,X,T,Z),this.fetchAndParseTile=(X,T,Z,b)=>this.actor.send("fetchAndParseTile",[],b,this.managerId,X,T,Z),this.fetchContourTile=(X,T,Z,b,x)=>this.actor.send("fetchContourTile",[],x,this.managerId,X,T,Z,b);const ue=this.managerId=++A;this.actor=de||m(),this.loaded=this.actor.send("init",[],void 0,{cacheSize:V,demUrlPattern:y,encoding:D,maxzoom:K,managerId:ue,timeoutMs:L}).value}}Blob.prototype.arrayBuffer||(Blob.prototype.arrayBuffer=function(){return new Promise((y,V)=>{const D=new FileReader;D.onload=K=>{var L;return y((L=K.target)===null||L===void 0?void 0:L.result)},D.onerror=V,D.readAsArrayBuffer(this)})});const E=new Set;class O{constructor({url:y,cacheSize:V=100,id:D="dem",encoding:K="terrarium",maxzoom:L=12,worker:de=!0,timeoutMs:ue=1e4,actor:X}){this.timingCallbacks=[],this.onTiming=x=>{this.timingCallbacks.push(x)},this.setupMaplibre=x=>{x.addProtocol(this.sharedDemProtocolId,this.sharedDemProtocol),x.addProtocol(this.contourProtocolId,this.contourProtocol)},this.sharedDemProtocol=(x,ee)=>{const[$,ne,fe]=this.parseUrl(x.url),re=new f.Timer("main"),ae=this.manager.fetchTile($,ne,fe,re);let J=!1;return(async()=>{let z;try{const I=await ae.value;if(z=re.finish(x.url),J)return;const _=await I.data.arrayBuffer();if(J)return;ee(void 0,_,I.cacheControl,I.expires)}catch(I){if(z=re.error(x.url),J)return;ee(I)}this.timingCallbacks.forEach(I=>I(z))})(),{cancel:()=>{J=!1,ae.cancel()}}},this.contourProtocol=(x,ee)=>{const $=new f.Timer("main"),[ne,fe,re]=this.parseUrl(x.url),ae=f.decodeOptions(x.url),J=this.manager.fetchContourTile(ne,fe,re,f.getOptionsForZoom(ae,ne),$);let z=!1;return(async()=>{let I;try{const _=await J.value;if(I=$.finish(x.url),z)return;ee(void 0,_.arrayBuffer)}catch(_){if(z)return;I=$.error(x.url),ee(_)}this.timingCallbacks.forEach(_=>_(I))})(),{cancel:()=>{z=!0,J.cancel()}}},this.contourProtocolUrl=x=>`${this.contourProtocolUrlBase}?${f.encodeOptions(x)}`;let T=D,Z=1;for(;E.has(T);)T=D+Z++;E.add(T),this.sharedDemProtocolId=`${T}-shared`,this.contourProtocolId=`${T}-contour`,this.sharedDemProtocolUrl=`${this.sharedDemProtocolId}://{z}/{x}/{y}`,this.contourProtocolUrlBase=`${this.contourProtocolId}://{z}/{x}/{y}`;const b=de?R:f.LocalDemManager;this.manager=new b(y,V,K,L,ue,X)}getDemTile(y,V,D){return this.manager.fetchAndParseTile(y,V,D).value}parseUrl(y){const[,V,D,K]=/\/\/(\d+)\/(\d+)\/(\d+)/.exec(y)||[];return[Number(V),Number(D),Number(K)]}}return{generateIsolines:f.generateIsolines,DemSource:O,HeightTile:f.HeightTile,LocalDemManager:f.LocalDemManager,decodeParsedImage:f.decodeParsedImage,set workerUrl(v){S.workerUrl=v},get workerUrl(){return S.workerUrl}}});var kt=Se;export{kt as m};
